<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="keywords" content="杨小福,yangxiaofu,前端,编程,html,css,javascript,nodeJS">
    <meta name="description" content="杨小福的博客，记点笔记">
    <title>
         杨小福|Nerver stop thinking 
    </title>
    <link rel="stylesheet" href="/css/public.css">
    <link rel="stylesheet" href="/css/page.css">
    <link rel="stylesheet" href="/css/monokai.min.css">
    <link rel="stylesheet" href="/css/post_add.css">
    <link id="theme-highlight" rel="stylesheet" href="//cdn.bootcss.com/highlight.js/8.9.1/styles/atelier-dune.light.min.css">
    <script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?0904845f91ea208faa55eaa72f93fab1";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
    </script>
</head>

<body>
    <div id="headerWrapper" class="cf">
        <header id="header" class="cf">
            <div id="logo">
                <h1 class="logo">
					<a href="/">Yangxiaofu</a>
				</h1>
                <div class="logo-subtitle">
                    programmer
                </div>
            </div>
            <nav id="main-nav">
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/archives">Posts</a></li>
                    <li><a href="/websites/index.html">Nav</a></li>
                    <li><a href="/Lab">Lab</a></li>
                    <li><a href="/about">About</a></li>
                </ul>
            </nav>
        </header>
    </div>
    
	<div id="pageWrapper">
		<div id="mainContent">
			<article class="post">
			<div class="items-wrap">
				
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				 	<div class="post-item">	
						<header>
							<h1>
								<a href="/2016/03/05/js/再谈闭包/" target="_blank">再谈对闭包的理解</a>
							</h1>
							<div class="post-info">
								<span class="post-time">
									<a class="permalink" href="" >2016-03-05</a>
								</span>
								<span class="post-tag">
									
									
										<a class="tag" href="http://www.yangxiaofu.com/tags/js/" target="_blank">js</a>
									
										<a class="tag" href="http://www.yangxiaofu.com/tags/pl/" target="_blank">pl</a>
									
								</span>
							</div>
						</header>
						<div class="post-body">
							
								<div class="post-excerpt">
									<h3 id="闭包只是为了实现词法作用域而用到的一种数据结构而已">闭包只是为了实现词法作用域而用到的一种数据结构而已</h3><p>先从阮一峰09年写的一篇关于闭包的文章开始<a href="http://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html">(原文地址)</a>文中说”可以把闭包理解为就是能够读取其他函数内部变量的函数,因为js中,只有函数内部的子函数才能读取局部变量，因此也可以把闭包定义在一个函数内部的函数。所以闭包本质就是将函数内部和函数外部连接起来的一座桥梁”。</p>
<p>毕竟不是专业学习js的，也不是程序语言方面的专家，在这里就不去计较了，下文会给出更完整的闭包说明。(PS:个人还是比较欣赏阮一峰写的文章的，能将一些概念讲得通俗易懂)</p>
<p>最后还留下了一个思考题</p>
<ul>
<li><p>示例01：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">　　<span class="keyword">var</span> name = <span class="string">"The Window"</span>;</span><br><span class="line">　　<span class="keyword">var</span> object = &#123;</span><br><span class="line">　　　　name : <span class="string">"My Object"</span>,</span><br><span class="line">　　　　getNameFunc : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">　　　　　　<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">　　　　　　　　<span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">　　　　　　&#125;;</span><br><span class="line">　　　　&#125;</span><br><span class="line">　　&#125;;</span><br><span class="line">　　alert(object.getNameFunc()());</span><br></pre></td></tr></table></figure>
</li>
<li><p>示例02：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">　　<span class="keyword">var</span> name = <span class="string">"The Window"</span>;</span><br><span class="line">　　<span class="keyword">var</span> object = &#123;</span><br><span class="line">　　　　name : <span class="string">"My Object"</span>,</span><br><span class="line">　　　　getNameFunc : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">　　　　　　<span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">　　　　　　<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">　　　　　　　　<span class="keyword">return</span> that.name;</span><br><span class="line">　　　　　　&#125;;</span><br><span class="line">　　　　&#125;</span><br><span class="line">　　&#125;;</span><br><span class="line">　　alert(object.getNameFunc()());</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>看完这道题，就希望大家将this和闭包分开，不要给自己找麻烦？</p>
								</div>
								<div class="post-more">
									<p>在开始说闭包之前，需要理解好以下的概念：</p>
<ul>
<li>词法作用域(静态作用域)</li>
<li>函数上下文</li>
</ul>
<p><a href="http://yangxiaofu.com/2016/01/25/js/closure-this/">之前简单的提过</a>,词法作用域简单的理解就是函数的上下文是在声明是确定的，而不是在调用时确定的。这里不想对这两个名词作过多的解释，我们知道js/ruby/python等主流的语言都是词法作用域就好，因为与之相对的动态作用域有许多的问题，所以现在的语言基本都是词法作用域的。</p>
<p>函数上下文就简单的理解为函数执行的环境好了，在这个环境中保存了函数执行所需的变量。</p>
<h3 id="JavaScript权威指南第六版关于闭包的说明">JavaScript权威指南第六版关于闭包的说明</h3><blockquote>
<p>JavaScript采用词法作用域，也就是说函数的执行依赖于变量的作用域，这个作用域是在函数定义时决定的，而不是函数调用时决定的。为了实现词法作用域，JavaScript函数对象的内部状态不仅包含函数的代码逻辑，还必须引用当前的作用域链。函数对象可以通过作用域链相互关联起来，函数体内部的变量都可以保存在函数作用域内，这种特性在计算机科学文献中称为”闭包”。</p>
<p>当定义一个函数时，它实际上保存了一个作用域链。当调用这个函数时，它创建<br>一个新的对象来存储它的局部变量，并将这个对象添加到保存的作用域链上。</p>
</blockquote>
<p>(闭包可以简单的理解为函数用来存储它的局部变量的对象，这个对象我们来说是不可见的，是js解释器实现的过程中才会用到的。每一个函数都会有这样的一个对象，作用域链则是这些对象之间的关系。)</p>
<p>“闭包”这个术语的来源：指函数变量可以被隐藏于作用域链之内，因此看起来是函数将变量”包裹”了起来。</p>
<p>看文字可能会比较绕，下面是书中的一个例子：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> scope = <span class="string">"global scope"</span>;			<span class="comment">/*全局变量*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkscope</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> scope = <span class="string">"local scope"</span>;		<span class="comment">/*局部变量*/</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> scope;&#125;</span><br><span class="line">	<span class="keyword">return</span> f();</span><br><span class="line">&#125;</span><br><span class="line">checkscope();						<span class="comment">/*=&gt;"local scope"*/</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> scope = <span class="string">"global scope"</span>;			<span class="comment">/*全局变量*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkscope</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> scope = <span class="string">"local scope"</span>;		<span class="comment">/*局部变量*/</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> scope;&#125;</span><br><span class="line">	<span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br><span class="line">checkscope()();						<span class="comment">/*=&gt;"local scope"*/</span></span><br></pre></td></tr></table></figure>
<p>checkscope最后的返回值都是一样的，即”local scope”。</p>
<p>上面两个例子的不同之处就是函数f执行的地方不同，一个在checkscope这个作用域里调用的(每一个函数都是一个作用域)，一个在全局作用域里调用的。回忆之前说的，函数调用时的上下文或者说作用域是在声明时确定的，所以与调用的位置无关，即f函数的调用位置虽然不同，调用的环境虽然不同，但最终的结果都是一样的。</p>
<p>说到这里，闭包就说得差不多了，回过头来看一下常规的对于闭包的理解：</p>
<blockquote>
<p>通过返回函数的形式取得函数的局部变量。</p>
</blockquote>
<p>这种说法本身没有错，但它只是闭包的一种表现形式，</p>
<p>比如将上例进行下更改：<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> scope = <span class="string">"global scope"</span>;			<span class="comment">/*全局变量*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkscope</span>(<span class="params">fn</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> scope = <span class="string">"local scope"</span>;		<span class="comment">/*局部变量*/</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> scope;&#125;</span><br><span class="line">	fn(f);</span><br><span class="line">&#125;</span><br><span class="line">checkscope(<span class="function"><span class="keyword">function</span>(<span class="params">func</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> scope = <span class="string">"func scope"</span>;</span><br><span class="line">	<span class="keyword">return</span> func();</span><br><span class="line">&#125;);									<span class="comment">/*=&gt;"local scope"*/</span></span><br></pre></td></tr></table></figure></p>
<p>改成类似回调的执行方式，结果还是一样的，注意结果并不是func scope，但是并没有返回f函数这一说，难道这就不是闭包了吗？(当然这里有点扣字眼)</p>
<h3 id="说说this">说说this</h3><p>想起最开始时的那个思考题了吗？与闭包就没什么关系(注：任何一个函数其实都用到了闭包，但我们暂且考虑两层以及两层以上的嵌套情况，未嵌套情况下因为使用的都是全局作用域，结果应该是很直观的)。this一般用来代表函数的调用对象，它和上下文对象并不是同一个，上下文对象对我们来说是不可见的，除了全局作用域。</p>
<ul>
<li><p>示例01：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">　　<span class="keyword">var</span> name = <span class="string">"The Window"</span>;</span><br><span class="line">　　<span class="keyword">var</span> object = &#123;</span><br><span class="line">　　　　name : <span class="string">"My Object"</span>,</span><br><span class="line">　　　　getNameFunc : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">　　　　　　<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">　　　　　　　　<span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">　　　　　　&#125;;</span><br><span class="line">　　　　&#125;</span><br><span class="line">　　&#125;;</span><br><span class="line">　　alert(object.getNameFunc()());		<span class="comment">/*The Window*/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>示例02：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">　　<span class="keyword">var</span> name = <span class="string">"The Window"</span>;</span><br><span class="line">　　<span class="keyword">var</span> object = &#123;</span><br><span class="line">　　　　name : <span class="string">"My Object"</span>,</span><br><span class="line">　　　　getNameFunc : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">　　　　　　<span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">　　　　　　<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">　　　　　　　　<span class="keyword">return</span> that.name;</span><br><span class="line">　　　　　　&#125;;</span><br><span class="line">　　　　&#125;</span><br><span class="line">　　&#125;;</span><br><span class="line"><span class="keyword">var</span> that = &#123;name: <span class="string">'xiaofu'</span>&#125;;			<span class="comment">/*干扰项*/</span> </span><br><span class="line">　　alert(object.getNameFunc()());		<span class="comment">/*My Object*/</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>我们再来看一下题目，示例01输出的是”The Window”,示例02输出的是”My Object”。</p>
<p>说明：<br>示例01最终执行的是 function(){return this.name}，因为没有显示指明调用对象，所以其this执行全局对象。<br>示例02先调用object.getNameFunc(),因为显示的指定了调用对象，所以内部的this是object(注：这里说的是this指向的问题，还没有说闭包)，接着执行function (){return that.name}，这个函数在getNameFunc这个函数作用域中声明的，所以它调用的时候使用的是这个作用域，即得到var that = this;的这个that;而不是外面的that。</p>
<h3 id="作用域链不等同于原型链">作用域链不等同于原型链</h3><p>真不知道这两个不相关的东西怎么会被等同起来看待，以后谁告诉我它们是同一个东西，我就想问了，ruby、python这种没有原型概念的语言难道就没有作用域链了吗？</p>
<p>更有甚者将变量声明提升和闭包混在一起，也是醉了。</p>
<h3 id="如果无法理解，但记住下面的一点使用技巧，那么遇到闭包和this时也能够轻松的应对">如果无法理解，但记住下面的一点使用技巧，那么遇到闭包和this时也能够轻松的应对</h3><ul>
<li>闭包：函数执行时变量的获取从声明的作用域处去获取(注意链式关系，当前没有就往父级找，知道全局作用域)</li>
<li>this：显示指定调用者则this就指向谁，如未指定则为全局对象</li>
</ul>
								</div>
								<a class="postMore" href="javascript:void(0);" data-show="false">......查看全文</a>
							
						</div>
						<hr>
						</div>
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				 	<div class="post-item">	
						<header>
							<h1>
								<a href="/2015/11/17/html语法标准/" target="_blank">html不能这么写，你知道吗？</a>
							</h1>
							<div class="post-info">
								<span class="post-time">
									<a class="permalink" href="" >2015-11-17</a>
								</span>
								<span class="post-tag">
									
									
										<a class="tag" href="http://www.yangxiaofu.com/tags/html/" target="_blank">html</a>
									
								</span>
							</div>
						</header>
						<div class="post-body">
							
								<div class="post-excerpt">
									<ul>
<li>a标签不可以嵌套交互式元素</li>
<li>块级元素可以包含内联元素和某些块级元素，内联元素不能包含块级元素，只能包含内联元素</li>
<li>p标签不能包含块级元素</li>
<li>这些标签不可包含块级元素</li>
<li>li标签可以包含div以及ul，ul的子元素应该只有li</li>
<li>元素并排（块级和块级并列，内联和内联并列)</li>
</ul>
								</div>
								<div class="post-more">
									<h2 id="标签错误嵌套">标签错误嵌套</h2><h3 id="语法错误">语法错误</h3><ul>
<li>a标签不可以嵌套交互式元素[a， audio（如果设置了controls属性）， button， details， embed， iframe， img（如果设置了usemap属性）， input（如果type属性不为hidden状态）， keygen， label， menu（如果type属性为toolbar状态），object（如果设置了usemap属性）， select， textarea， video（如果设置了controls属性）]</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">/*下面这些写法浏览器是不能够正常解析的*/</span><br><span class="line">&lt;a href=""&gt;</span><br><span class="line">	&lt;a href=""&gt;click&lt;/a&gt;</span><br><span class="line">&lt;/a&gt;</span><br><span class="line">&lt;a href=""&gt;</span><br><span class="line">	&lt;button&gt;click&lt;/button&gt;</span><br><span class="line">&lt;/a&gt;</span><br><span class="line">&lt;a href=""&gt;</span><br><span class="line">	&lt;input type="text"&gt;</span><br><span class="line">&lt;/a&gt;</span><br><span class="line">&lt;a href=""&gt;</span><br><span class="line">	&lt;textarea name="" id="" cols="10" rows="5"&gt;&lt;/textarea&gt;</span><br><span class="line">&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<p><a href=""><a href="">click</a></a><a href=""><button>click</button></a><a href=""><input type="text"></a><a href=""><textarea name="" id="" cols="30" rows="10"></textarea></a></p>
<p>有的虽然解析正常，但却达不到预想的目的</p>
<h3 id="语义错误">语义错误</h3><p>页面可能正常解析，但不符合语义。这是因为浏览器自带容错机制，对于不规范的写法也能够正确的解析，各浏览器的容错机制不同，所以尽量按规范来写。</p>
<ul>
<li>块级元素可以包含内联元素和某些块级元素，内联元素不能包含块级元素，只能包含内联元素</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">/*规范的写法*/</span><br><span class="line">&lt;div&gt;</span><br><span class="line">	&lt;h2&gt;jikexueyuan&lt;/h2&gt;</span><br><span class="line">	&lt;p&gt;IT education&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">/*不规范的写法*/</span><br><span class="line">&lt;span&gt;</span><br><span class="line">	&lt;div&gt;wrong&lt;/div&gt;</span><br><span class="line">&lt;/span&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>p标签不能包含块级元素</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">/*不规范的写法*/</span><br><span class="line">&lt;p&gt;</span><br><span class="line">	&lt;h1&gt;&lt;/h1&gt;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">&lt;p&gt;</span><br><span class="line">	&lt;div&gt;&lt;/div&gt;</span><br><span class="line">&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>如下的标签不可包含块级元素</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">h1、h2、h3、h4、h5、h6、p</span><br><span class="line"></span><br><span class="line">/*不规范的写法*/</span><br><span class="line">&lt;h1&gt;</span><br><span class="line">	&lt;h2&gt;&lt;/h2&gt;</span><br><span class="line">&lt;/h1&gt;</span><br><span class="line">&lt;h2&gt;</span><br><span class="line">	&lt;p&gt;&lt;/p&gt;</span><br><span class="line">&lt;/h2&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>li标签可以包含div以及ul(这个是不是很牛，可以包含父级元素)</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">/*规范的写法*/</span><br><span class="line">&lt;li&gt;</span><br><span class="line">	&lt;ul&gt;</span><br><span class="line">		&lt;li&gt;&lt;/li&gt;</span><br><span class="line">		&lt;li&gt;&lt;/li&gt;</span><br><span class="line">		&lt;li&gt;&lt;/li&gt;</span><br><span class="line">	&lt;/ul&gt;</span><br><span class="line">	&lt;div&gt;&lt;/div&gt;</span><br><span class="line">&lt;/li&gt;</span><br><span class="line">/*不规范的写法*/</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">	&lt;a href=""&gt;迷路的a标签&lt;/a&gt;</span><br><span class="line">	&lt;li&gt;&lt;/li&gt;</span><br><span class="line">	&lt;li&gt;&lt;/li&gt;</span><br><span class="line">	&lt;li&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>元素并排（块级和块级并列，内联和内联并列)</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">/*规范的写法*/</span><br><span class="line">&lt;div&gt;</span><br><span class="line">	&lt;h2&gt;&lt;/h2&gt;</span><br><span class="line">	&lt;p&gt;&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">	&lt;img src="" alt=""&gt;</span><br><span class="line">	&lt;a href=""&gt;&lt;/a&gt;</span><br><span class="line">	&lt;span&gt;&lt;/span&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">/*不规范的写法*/</span><br><span class="line">&lt;div&gt;</span><br><span class="line">	&lt;span&gt;我是内联元素&lt;/span&gt;</span><br><span class="line">	&lt;p&gt;我是块级元素&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>如有错误，请指出，欢迎补充其它一些错误情况。</p>
								</div>
								<a class="postMore" href="javascript:void(0);" data-show="false">......查看全文</a>
							
						</div>
						<hr>
						</div>
				 	
				
				 	
				
				 	
				
				 	
				
				 	
				
				</div>
				<p class="text-center">
					<a id="look_more" class="warning-btn" href="/archives">查看更多</a>
				</p>
			</article>
		</div>
	</div>

    <footer id="footer">
        <i id="upToTop"></i>
        <p>
            联系方式 <span>|</span> <a href="javascript:void(0);">yangxiaofuPL@163.com</a>
        </p>
    </footer>
    <script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="/js/highlight.min.js"></script>
    <script src="/js/post.js"></script>
    <script>
    $(document).ready(function() {
        $('.highlight').each(function(i, block) {
            hljs.highlightBlock(block);
        });
    });
    </script>
</body>

</html>
